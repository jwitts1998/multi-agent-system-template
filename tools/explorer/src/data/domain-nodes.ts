import type { Node } from '@xyflow/react';

export type CalibrationState = {
  relevance: 'core' | 'supporting' | 'not-applicable';
  isAiDifferentiator?: boolean;
};

export interface DomainNodeData {
  name: string;
  tier: 0 | 1 | 2 | 3;
  tierLabel: string;
  scope: string;
  aiApplications: { builder: string[]; consumer: string[] };
  dependencies: string[];
  consultedBy: string[];
  monitoringHooks: string[];
  maintenanceTriggers: string[];
  modernPractices: string[];
  phase: 'foundation' | 'feature' | 'experience' | 'orchestration';
  filePath: string;
  calibration?: CalibrationState;
  [key: string]: unknown;
}

export type DomainNode = Node<DomainNodeData>;

const P = { x: 0, y: 0 };

export const domainNodes: DomainNode[] = [
  // --- Orchestration (Tier 0) ---
  {
    id: 'domain-product-orchestrator',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Product Orchestrator',
      tier: 0,
      tierLabel: 'Orchestration',
      scope: 'Cross-domain conflict resolution, AI strategy, domain lifecycle, multi-domain feature coordination.',
      aiApplications: {
        builder: [
          'AI-driven conflict resolution using historical decision records',
          'Automated domain health assessment from telemetry',
          'AI strategy recommendations based on vertical analysis',
        ],
        consumer: [],
      },
      dependencies: [],
      consultedBy: [],
      monitoringHooks: [
        'Cross-domain conflict frequency',
        'Domain agent invocation distribution',
        'AI strategy compliance rate',
      ],
      maintenanceTriggers: [
        'New domain agent created or retired',
        'Recurring cross-domain conflicts',
        'AI strategy review cycle',
      ],
      modernPractices: [
        'Architecture decision records for all cross-domain resolutions',
        'Periodic domain boundary review',
        'AI strategy versioning and tracking',
      ],
      phase: 'orchestration',
      filePath: 'templates/subagents/system/product-orchestrator.md',
    },
  },
  {
    id: 'domain-router',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Domain Router',
      tier: 0,
      tierLabel: 'Orchestration',
      scope: 'Routes tasks to domain agents. Analyzes task signals to identify primary, supporting, and consulting domains.',
      aiApplications: {
        builder: [
          'AI-assisted task analysis for domain identification',
          'Pattern learning from routing history',
          'Automated domain_agents field population',
        ],
        consumer: [],
      },
      dependencies: [],
      consultedBy: [],
      monitoringHooks: [
        'Routing accuracy (were the right domains identified?)',
        'Ambiguity resolution frequency',
        'Task coverage (% of tasks with domain_agents)',
      ],
      maintenanceTriggers: [
        'New domain agent added to registry',
        'Routing accuracy drops below threshold',
        'New code areas not covered by routing matrix',
      ],
      modernPractices: [
        'Keyword + file path + spec ref signal matching',
        'Primary / supporting / consulting classification',
        'Bulk task scan for domain coverage',
      ],
      phase: 'orchestration',
      filePath: 'templates/subagents/system/domain-router.md',
    },
  },

  // --- Tier 1: Foundation ---
  {
    id: 'domain-schema-data',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Schema / Data',
      tier: 1,
      tierLabel: 'Foundation',
      scope: 'Entity design, migrations, relationships, validation rules, data integrity, indexing strategy.',
      aiApplications: {
        builder: [
          'Generate migrations from natural language',
          'Auto-detect schema drift between environments',
          'Suggest indexes from query patterns',
          'Validate migration safety',
          'Generate seed data from schema',
        ],
        consumer: [
          'Natural language data queries for stakeholders',
          'Anomaly detection on data quality',
          'AI-powered data classification (PII tagging)',
          'Schema-aware autocomplete for admin tools',
        ],
      },
      dependencies: [],
      consultedBy: [
        'domain-maps-geo', 'domain-messaging', 'domain-search-discovery',
        'domain-payments-billing', 'domain-notifications', 'domain-media-content',
        'domain-analytics-telemetry',
      ],
      monitoringHooks: [
        'Migration execution time and success rate',
        'Schema drift detection',
        'Constraint violation frequency',
        'Table growth rate and storage consumption',
        'Slow query correlation with missing indexes',
      ],
      maintenanceTriggers: [
        'New feature domain needs data models',
        'Database version upgrade',
        'Performance degradation in data layer',
        'Compliance or regulatory changes',
      ],
      modernPractices: [
        'Reversible migrations with expand-contract pattern',
        'Type-safe ORM/schema definitions',
        'Soft deletes with configurable retention',
        'Constraint-driven design (push validation to DB)',
        'Schema versioning tied to releases',
      ],
      phase: 'foundation',
      filePath: 'templates/subagents/domains/schema-data.md',
    },
  },
  {
    id: 'domain-api-connections',
    type: 'domainNode',
    position: P,
    data: {
      name: 'API Connections',
      tier: 1,
      tierLabel: 'Foundation',
      scope: 'REST/GraphQL/gRPC design, versioning, webhooks, rate limiting, third-party integrations.',
      aiApplications: {
        builder: [
          'Auto-generate client SDKs from OpenAPI specs',
          'Detect breaking changes in API diffs',
          'Generate mock servers from schemas',
          'Suggest rate limit configs from traffic',
        ],
        consumer: [
          'Natural language API query layer',
          'AI-powered API explorer for developers',
          'Intelligent webhook routing',
          'Smart retry strategies from error patterns',
        ],
      },
      dependencies: ['domain-schema-data'],
      consultedBy: [
        'domain-maps-geo', 'domain-messaging', 'domain-search-discovery',
        'domain-payments-billing', 'domain-notifications', 'domain-media-content',
        'domain-analytics-telemetry',
      ],
      monitoringHooks: [
        'API response latency p50/p95/p99',
        'Error rate by endpoint and status code',
        'Rate limit hit frequency',
        'Third-party API availability',
        'Webhook delivery success rate',
        'API version adoption distribution',
      ],
      maintenanceTriggers: [
        'New third-party integration required',
        'API version deprecation approaching',
        'Third-party API breaking changes',
        'Traffic pattern shifts',
      ],
      modernPractices: [
        'Contract-first design (OpenAPI/GraphQL SDL)',
        'Versioning from day one',
        'Idempotency keys on all mutations',
        'Circuit breakers for third-party calls',
        'Webhook at-least-once delivery with signature verification',
      ],
      phase: 'foundation',
      filePath: 'templates/subagents/domains/api-connections.md',
    },
  },
  {
    id: 'domain-auth-identity',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Auth / Identity',
      tier: 1,
      tierLabel: 'Foundation',
      scope: 'Authentication flows, authorization models, sessions, tokens, permissions, multi-tenancy.',
      aiApplications: {
        builder: [
          'Auto-generate permission matrices from roles',
          'Detect overly permissive roles',
          'Generate auth middleware from permission schemas',
          'Security-focused code review for auth changes',
        ],
        consumer: [
          'Adaptive authentication (risk-based step-up MFA)',
          'Conversational identity verification',
          'Smart session anomaly detection',
          'Natural language permission management for admins',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections'],
      consultedBy: [
        'domain-maps-geo', 'domain-messaging', 'domain-search-discovery',
        'domain-payments-billing', 'domain-notifications', 'domain-media-content',
      ],
      monitoringHooks: [
        'Auth success/failure rates by method',
        'Token refresh frequency and failure rate',
        'Failed login attempt patterns',
        'MFA adoption rate',
        'Unusual login pattern detection',
      ],
      maintenanceTriggers: [
        'Identity provider API changes',
        'Security advisory affecting auth libraries',
        'Compliance requirements change (GDPR, SOC2)',
        'New login method requested (passkeys, biometrics)',
      ],
      modernPractices: [
        'Never roll your own auth — use managed services',
        'Short-lived access tokens + refresh tokens',
        'Principle of least privilege (deny-by-default)',
        'Rate limit all auth endpoints',
        'Audit every auth event',
      ],
      phase: 'foundation',
      filePath: 'templates/subagents/domains/auth-identity.md',
    },
  },
  {
    id: 'domain-infrastructure',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Infrastructure',
      tier: 1,
      tierLabel: 'Foundation',
      scope: 'CI/CD, cloud resources, environments, containers, scaling, monitoring scaffolding, secrets.',
      aiApplications: {
        builder: [
          'Generate IaC from natural language',
          'Auto-detect misconfigured resources',
          'Predict resource needs from traffic patterns',
          'Generate CI/CD configs from project structure',
        ],
        consumer: [
          'Natural language infra queries ("why did latency spike?")',
          'AI-assisted incident triage',
          'Predictive auto-scaling',
          'ChatOps (deploy/rollback via conversation)',
        ],
      },
      dependencies: [],
      consultedBy: ['domain-performance'],
      monitoringHooks: [
        'Deployment success/failure rate',
        'Resource utilization across environments',
        'CI/CD pipeline duration and failure rate',
        'Cloud cost by service and environment',
        'Certificate expiration countdown',
        'Incident response time',
      ],
      maintenanceTriggers: [
        'Cloud provider service deprecation',
        'Infrastructure cost exceeds budget',
        'Security vulnerability in base images',
        'Traffic growth requires architecture changes',
        'Major runtime version upgrade',
      ],
      modernPractices: [
        'Infrastructure as Code (all resources versioned)',
        'Immutable deployments (blue-green or canary)',
        'Preview environments per PR',
        'GitOps (deployment state in git)',
        'Least-privilege IAM',
      ],
      phase: 'foundation',
      filePath: 'templates/subagents/domains/infrastructure.md',
    },
  },

  // --- Tier 2: Feature ---
  {
    id: 'domain-maps-geo',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Maps / Geolocation',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'Map rendering, geocoding, routing, spatial queries, geofencing, location permissions.',
      aiApplications: {
        builder: [
          'Auto-generate spatial indexes from query patterns',
          'Suggest geofence boundaries from usage data',
          'Detect map rendering performance regressions',
        ],
        consumer: [
          'Natural language place search',
          'Predictive destination suggestions',
          'AI-generated route narratives',
          'Semantic geofencing',
          'Context-aware place understanding',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections', 'domain-auth-identity'],
      consultedBy: ['domain-animation-motion', 'domain-performance', 'domain-accessibility'],
      monitoringHooks: [
        'Tile load latency p50/p95/p99',
        'Geocoding success rate',
        'Location permission grant/deny ratio',
        'Geofence trigger accuracy',
        'Map provider API cost',
      ],
      maintenanceTriggers: [
        'Tile provider deprecation or pricing change',
        'New spatial data format adoption',
        'Privacy regulation changes',
        'Map rendering library major update',
      ],
      modernPractices: [
        'Vector tiles over raster',
        'Provider abstraction layer',
        'Server-side geocoding with client caching',
        'Privacy-first location requests',
        'H3/S2 cells for spatial aggregation',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/maps-geo.md',
    },
  },
  {
    id: 'domain-messaging',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Messaging',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'Real-time chat, channels, presence, typing indicators, message delivery, threading.',
      aiApplications: {
        builder: [
          'Auto-generate message type schemas',
          'Load test with synthetic conversations',
          'Detect message delivery anomalies',
        ],
        consumer: [
          'Smart replies (context-aware suggestions)',
          'Conversation summarization',
          'Intent detection for message routing',
          'Real-time content moderation',
          'Cross-language message translation',
          'Sentiment analysis',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections', 'domain-auth-identity'],
      consultedBy: ['domain-animation-motion', 'domain-performance', 'domain-accessibility'],
      monitoringHooks: [
        'Message delivery latency p50/p95/p99',
        'WebSocket connection success rate',
        'Message throughput per channel',
        'Presence update latency',
        'Undelivered message queue depth',
      ],
      maintenanceTriggers: [
        'Real-time service provider changes',
        'Message volume growth requires sharding',
        'New message types (voice, video, cards)',
        'Compliance requirements for encryption',
      ],
      modernPractices: [
        'WebSockets for bidirectional real-time',
        'Managed real-time services over self-hosted',
        'Optimistic UI with server reconciliation',
        'Message deduplication via idempotency keys',
        'Offline-first with sync on reconnect',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/messaging.md',
    },
  },
  {
    id: 'domain-search-discovery',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Search / Discovery',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'Full-text search, semantic/vector search, autocomplete, filters, facets, recommendations.',
      aiApplications: {
        builder: [
          'Auto-generate index mappings from schema',
          'Fine-tune embedding models on product content',
          'Detect search relevance degradation',
          'Auto-tune ranking weights from click data',
        ],
        consumer: [
          'Semantic search via embeddings',
          'Conversational search',
          'Personalized ranking',
          'Query understanding (intent + entity extraction)',
          'Visual search (search by image)',
          'Natural language filters',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections'],
      consultedBy: ['domain-performance', 'domain-analytics-telemetry', 'domain-accessibility'],
      monitoringHooks: [
        'Search query latency p50/p95/p99',
        'Zero-result query rate',
        'Search-to-click conversion rate',
        'Index sync lag',
        'Autocomplete response time',
      ],
      maintenanceTriggers: [
        'Search service version upgrade',
        'Index size exceeds performance threshold',
        'Search relevance metrics decline',
        'New content types need indexing',
        'Embedding model upgrade available',
      ],
      modernPractices: [
        'Hybrid search (BM25 + vector similarity)',
        'Search-as-you-type within 100ms',
        'Facets with result counts',
        'Typo tolerance with fuzzy matching',
        'Search analytics pipeline (queries, clicks, conversions)',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/search-discovery.md',
    },
  },
  {
    id: 'domain-payments-billing',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Payments / Billing',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'Checkout, subscriptions, invoicing, usage metering, refunds, tax, PCI compliance.',
      aiApplications: {
        builder: [
          'Auto-generate pricing page components',
          'Detect billing edge cases in tests',
          'Generate synthetic transaction data',
          'Validate PCI compliance in code changes',
        ],
        consumer: [
          'Natural language billing queries',
          'AI-powered fraud detection',
          'Pricing optimization and A/B analysis',
          'Smart dunning (personalized retry timing)',
          'Subscription recommendations based on usage',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections', 'domain-auth-identity'],
      consultedBy: ['domain-analytics-telemetry', 'domain-notifications'],
      monitoringHooks: [
        'Payment success/failure rate',
        'Checkout abandonment rate',
        'Subscription churn rate',
        'Revenue metrics (MRR, ARR, ARPU)',
        'Dunning recovery rate',
        'Refund and dispute rate',
      ],
      maintenanceTriggers: [
        'Payment processor API version upgrade',
        'New payment method support needed',
        'Tax regulation changes',
        'PCI DSS compliance audit',
        'Pricing model changes',
      ],
      modernPractices: [
        'Never handle raw card numbers — tokenize',
        'Idempotency keys on all payment operations',
        'Webhook-driven state management',
        'Tax automation via services',
        'Full audit trail for financial events',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/payments-billing.md',
    },
  },
  {
    id: 'domain-notifications',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Notifications',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'Push, email, in-app, SMS delivery, scheduling, batching, preferences, templates.',
      aiApplications: {
        builder: [
          'Auto-generate notification templates from events',
          'Detect notification fatigue patterns',
          'Validate compliance (required footers, unsubscribe)',
        ],
        consumer: [
          'Send-time optimization',
          'AI-generated notification copy',
          'Smart batching and summarization',
          'Notification priority scoring',
          'Channel recommendation per user',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections', 'domain-auth-identity'],
      consultedBy: [],
      monitoringHooks: [
        'Delivery rate by channel',
        'Open rate and click-through rate',
        'Bounce and unsubscribe rate',
        'Delivery latency',
        'Notification volume over time',
      ],
      maintenanceTriggers: [
        'Push provider API changes (APNs, FCM)',
        'Email deliverability issues',
        'New notification channel required',
        'Compliance regulation changes',
      ],
      modernPractices: [
        'User controls before sending anything',
        'Template-driven content with variable substitution',
        'Batching and digests for related notifications',
        'Graceful degradation across channels',
        'One-tap unsubscribe',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/notifications.md',
    },
  },
  {
    id: 'domain-media-content',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Media / Content',
      tier: 2,
      tierLabel: 'Feature',
      scope: 'File uploads, image/video processing, CDN delivery, transcoding, storage lifecycle.',
      aiApplications: {
        builder: [
          'Auto-generate processing pipelines from requirements',
          'Detect orphaned media',
          'Optimize CDN cache policies from access patterns',
        ],
        consumer: [
          'Auto-tagging and categorization',
          'Alt text generation for accessibility',
          'Content moderation (NSFW detection)',
          'Smart cropping (face/subject focus)',
          'Video summarization',
          'Document understanding (extract structured data)',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections', 'domain-auth-identity'],
      consultedBy: ['domain-performance', 'domain-accessibility', 'domain-animation-motion'],
      monitoringHooks: [
        'Upload success/failure rate',
        'Processing pipeline latency',
        'CDN cache hit ratio',
        'Storage consumption by tier',
        'Content moderation action rate',
      ],
      maintenanceTriggers: [
        'CDN or storage provider pricing change',
        'New media format gaining browser support',
        'Processing library major update',
        'Content moderation policy changes',
      ],
      modernPractices: [
        'Direct-to-storage uploads via presigned URLs',
        'Resumable uploads for files over 5MB',
        'Async processing with progress feedback',
        'Modern formats first (WebP, AVIF, H.265)',
        'Content-addressable storage for dedup',
      ],
      phase: 'feature',
      filePath: 'templates/subagents/domains/media-content.md',
    },
  },

  // --- Tier 3: Experience ---
  {
    id: 'domain-animation-motion',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Animation / Motion',
      tier: 3,
      tierLabel: 'Experience',
      scope: 'Transitions, micro-interactions, loading states, gesture feedback, motion performance budgets.',
      aiApplications: {
        builder: [
          'Detect animation performance regressions',
          'Suggest optimal duration/easing for transitions',
          'Identify reduced-motion accessibility violations',
        ],
        consumer: [
          'Adaptive animations for device capability',
          'Generative motion design from descriptions',
          'Personalized motion preferences',
          'AI-driven attention guidance via subtle motion',
        ],
      },
      dependencies: [],
      consultedBy: [],
      monitoringHooks: [
        'Frame rate during animations (target 60fps)',
        'Animation duration budget compliance',
        'GPU memory usage during animations',
        'Jank detection (long frame counts)',
        'Reduced motion adoption rate',
      ],
      maintenanceTriggers: [
        'Animation library major version update',
        'New platform animation APIs available',
        'Performance profiling reveals jank',
        'Design system motion refresh',
      ],
      modernPractices: [
        '60fps or nothing — profile and budget',
        'Only animate transform and opacity (GPU composited)',
        'Spring physics over linear easing',
        'Respect prefers-reduced-motion',
        'Skeleton screens over spinners',
      ],
      phase: 'experience',
      filePath: 'templates/subagents/domains/animation-motion.md',
    },
  },
  {
    id: 'domain-accessibility',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Accessibility',
      tier: 3,
      tierLabel: 'Experience',
      scope: 'WCAG compliance, screen reader support, keyboard navigation, color contrast, focus management.',
      aiApplications: {
        builder: [
          'Automated accessibility auditing in CI/CD',
          'Auto-generate ARIA labels from context',
          'Detect color contrast violations',
          'Generate accessible test scenarios',
        ],
        consumer: [
          'AI-generated alt text for user images',
          'Real-time caption generation for audio/video',
          'Adaptive UI complexity for cognitive needs',
          'Voice-controlled navigation',
          'AI-powered reading assistance',
        ],
      },
      dependencies: [],
      consultedBy: [],
      monitoringHooks: [
        'Automated accessibility score per page',
        'Keyboard navigation coverage',
        'Color contrast compliance rate',
        'Screen reader error rate',
        'Focus management issues',
        'Touch target size compliance',
      ],
      maintenanceTriggers: [
        'WCAG version update',
        'Screen reader behavior changes',
        'UI component library version update',
        'Accessibility audit findings',
        'Legal compliance requirements',
      ],
      modernPractices: [
        'Semantic HTML (button, nav, not div onClick)',
        'Test with real assistive technology',
        'Visible focus indicators always',
        'Color is never the only indicator',
        'Error messages specific and associated with fields',
      ],
      phase: 'experience',
      filePath: 'templates/subagents/domains/accessibility.md',
    },
  },
  {
    id: 'domain-internationalization',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Internationalization',
      tier: 3,
      tierLabel: 'Experience',
      scope: 'String extraction, translation tooling, locale formatting, RTL support, cultural adaptation.',
      aiApplications: {
        builder: [
          'Auto-detect hardcoded strings for extraction',
          'Generate i18n keys from code context',
          'Validate translation completeness per locale',
          'Detect layout issues via pseudo-localization',
        ],
        consumer: [
          'AI-powered translation for user content',
          'Real-time cross-language conversations',
          'Cultural adaptation beyond language',
          'Context-aware translation quality assessment',
          'Automatic language detection',
        ],
      },
      dependencies: [],
      consultedBy: [],
      monitoringHooks: [
        'Translation coverage by locale',
        'Missing translation fallback frequency',
        'Locale distribution of active users',
        'RTL layout regression rate',
        'Pseudo-localization test pass rate',
      ],
      maintenanceTriggers: [
        'New target locale added',
        'i18n library major version update',
        'RTL support needed for existing components',
        'Translation workflow tool change',
      ],
      modernPractices: [
        'Extract all strings from day one',
        'ICU MessageFormat for plurals and gender',
        'Locale-aware Intl APIs for formatting',
        'Pseudo-localization in CI',
        'RTL-first CSS with logical properties',
      ],
      phase: 'experience',
      filePath: 'templates/subagents/domains/internationalization.md',
    },
  },
  {
    id: 'domain-performance',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Performance',
      tier: 3,
      tierLabel: 'Experience',
      scope: 'Bundle size, rendering speed, caching, lazy loading, Core Web Vitals, profiling.',
      aiApplications: {
        builder: [
          'AI-assisted performance profiling',
          'Auto-detect regressions in CI build metrics',
          'Suggest code splitting points from bundle analysis',
          'Identify unused code and dead imports',
        ],
        consumer: [
          'Predictive prefetching (pre-load likely content)',
          'Adaptive quality for slow connections',
          'Smart caching with AI-driven eviction',
          'Performance-aware feature flags',
        ],
      },
      dependencies: ['domain-infrastructure'],
      consultedBy: [],
      monitoringHooks: [
        'Core Web Vitals (LCP, CLS, INP)',
        'Bundle size per route',
        'Time to Interactive per page',
        'Server response time p50/p95/p99',
        'Memory usage trends',
        'Cache hit ratio',
      ],
      maintenanceTriggers: [
        'Core Web Vitals decline',
        'Bundle size exceeds budget',
        'New dependency adds significant weight',
        'Framework offers performance improvements',
        'User complaints about speed',
      ],
      modernPractices: [
        'Performance budgets from day one',
        'Real user monitoring (RUM) over synthetic',
        'Code split by route at minimum',
        'Lazy load below the fold',
        'Compress everything (Brotli, WebP, AVIF)',
      ],
      phase: 'experience',
      filePath: 'templates/subagents/domains/performance.md',
    },
  },
  {
    id: 'domain-analytics-telemetry',
    type: 'domainNode',
    position: P,
    data: {
      name: 'Analytics / Telemetry',
      tier: 3,
      tierLabel: 'Experience',
      scope: 'Event tracking, funnels, cohorts, dashboards, A/B testing, privacy-compliant data collection.',
      aiApplications: {
        builder: [
          'Auto-generate tracking code from specs',
          'Detect tracking gaps in features',
          'Validate event taxonomy consistency',
          'Auto-create A/B test analysis reports',
        ],
        consumer: [
          'Natural language analytics queries',
          'Anomaly detection on metrics',
          'AI-generated insight summaries',
          'Predictive analytics (churn, growth)',
          'Automated experiment analysis',
          'AI-discovered user segments',
        ],
      },
      dependencies: ['domain-schema-data', 'domain-api-connections'],
      consultedBy: [],
      monitoringHooks: [
        'Event ingestion rate and processing latency',
        'Tracking coverage (% of features with events)',
        'Event schema validation error rate',
        'Dashboard load time',
        'Consent opt-in rate',
      ],
      maintenanceTriggers: [
        'Analytics platform API changes',
        'Privacy regulation changes',
        'Event volume exceeds budget',
        'New product areas need tracking',
        'Metric definitions need revision',
      ],
      modernPractices: [
        'Event taxonomy before implementation',
        'Track behavior, not PII (anonymize by default)',
        'Server-side tracking for critical events',
        'Privacy by design (consent, Do Not Track)',
        'Cohort-based analysis over aggregates',
      ],
      phase: 'experience',
      filePath: 'templates/subagents/domains/analytics-telemetry.md',
    },
  },
];
